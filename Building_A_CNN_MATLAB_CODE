%% Import Image Data Set

imds = imageDatastore("Fruit_Dataset","IncludeSubfolders",true,'labelSource','foldernames');

%% Define CNN architecture
layer = [
    imageInputLayer([100 100 3])
    
    convolution2dLayer(3,16,'Padding','same')
    batchNormalizationLayer
    reluLayer
    
    fullyConnectedLayer(4)
    softmaxLayer
    classificationLayer
    ];

%% Open Deep Neural Network Designer Page

  deepNetworkDesigner
  
%% Plotting a 3D Plot of the Performances at different Learning Rates
% 
% 
% % rawtable = readtable('Learning_Rate_0_005.xlsx')
% % plot3(rawtable.Var2,rawtable.Var1,rawtable.Var3)
% 
% 
% % For Learning rate = 0.1
% x1 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];
% z1 = [1.95169615745544,10.3376398086548,12.3304376602173,13.3268365859985,3.93885612487793,5.51208114624023,3.29343199729919,2.29448699951172,2.97997522354126,1.00736212730408,1.41602098941803,1.45141196250916,1.45846056938171,1.43391776084900,1.48153007030487,1.87148153781891,1.43921148777008,1.55914568901062,1.38059711456299,1.48962318897247,1.41362738609314,1.43474292755127,1.37355792522430,1.45122551918030,1.92141890525818,1.37934803962708,1.37693274021149,1.37477898597717,1.34784197807312,1.36630260944366,1.34800243377686,1.41014361381531,1.39471292495728,1.35061717033386,1.37117815017700,1.39278650283813];
% y1 = [0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1];
% 
% % For Learning rate = 0.01
% x2 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z2 = [1.50002813339233,6.47659349441528,12.3273973464966,8.69495201110840,11.6144351959229,7.05736303329468,1.86264537127556e-09,2.56441974639893,0.0157992988824844,0.00540789123624563,0.183390647172928,0.111577577888966,6.10998949923669e-06,0.00301697873510420,0.0739255994558334,0,0.0296828169375658,7.02470497344621e-05,0,8.45011527417228e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
% y2 = [0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01];
% 
% % For Learning rate = 0.001
% x3 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z3 = [1.50002813339233, 3.95038962364197, 6.05430793762207, 2.36948728561401, 0.0733035653829575, 0.0659947991371155, 0.00780367851257324, 0.217635393142700, 0.0209896676242352, 9.57621014094912e-05, 3.53908490069443e-07, 4.30360660175211e-06, 1.39698412837674e-08, 1.76951342467646e-08, 3.72529385117559e-08, 3.72537868997824e-07, 2.11411361306091e-07, 4.08341247748467e-06, 1.21072119441124e-07, 2.31318153964821e-06, 1.76676007868082e-06, 1.38639707074617e-05, 1.51118383655557e-05, 0.000245798495598137, 3.93014306609985e-05, 2.72579268312256e-06, 2.78229745163117e-05, 6.28825910098385e-06, 0.000148458362673409, 0.000554196070879698, 6.14444143138826e-05, 1.24599482660415e-05, 1.27036844332906e-06, 6.46343039534258e-07, 1.23176396300551e-05, 3.12517149723135e-05];
% y3 = [0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001];
% 
% % For Learning rate = 0.0001
% x4 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z4 = [1.50002813339233,1.17888820171356,0.951249778270721,0.598517179489136,0.404472887516022,0.196766749024391,0.140642315149307,0.0728855654597282,0.0427086204290390,0.0681859478354454,0.0726036503911018,0.0464546941220760,0.0135420095175505,0.0101515818387270,0.0104334466159344,0.00562526704743505,0.00941355247050524,0.00706082815304399,0.00759853841736913,0.00594454724341631,0.00518133724108338,0.00608727149665356,0.00497490400448442,0.00245844898745418,0.00206737127155066,0.00201524305157363,0.00221587996929884,0.00109311239793897,0.000971541856415570,0.000948206696193665,0.000609540787991136,0.000724742829333991,0.000804459094069898,0.000664286548271775,0.000581396685447544,0.000778810470364988];
% y4 = [0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001];
% 
% % For Learning rate = 0.00001
% x5 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z5 = [1.48280262947083,1.41973268985748,1.28894579410553,1.15318012237549,1.09840297698975,1.01494765281677,1.04737281799316,0.844577968120575,0.801182031631470,0.744086384773254,0.610235810279846,0.518391311168671,0.438575059175491,0.432396650314331,0.409391641616821,0.331263303756714,0.332292824983597,0.313462018966675,0.264211475849152,0.273242920637131,0.218430727720261,0.210004046559334,0.207237243652344,0.204236060380936,0.183247208595276,0.139573991298676,0.147762253880501,0.148526743054390,0.140718787908554,0.123422116041183,0.118510901927948,0.109481498599052,0.0965465605258942,0.0917223244905472,0.112668976187706,0.0888465195894241];
% %y5 = [0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001,0.00001];
% 
% % For Learning rate = 0.000001
% x6 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z6 = [1.62411212921143,1.76194715499878,1.70840024948120,1.66004395484924,1.70964741706848,1.65128743648529,1.61825382709503,1.63978326320648,1.58125162124634,1.61903357505798,1.46007108688355,1.49800014495850,1.47571778297424,1.43822836875916,1.31506276130676,1.37380456924438,1.28424441814423,1.30983078479767,1.34843802452087,1.29134809970856,1.18674159049988,1.27583956718445,1.15328252315521,1.22932767868042,1.16990745067596,1.11036407947540,1.02760982513428,1.02713859081268,1.08958888053894,1.00991368293762,1.04060375690460,0.967712581157684,0.968751251697540,0.878379166126251,0.931686997413635,0.891565561294556];
% %y6 = [0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001,0.000001];
% 
% % For Learning rate = 0.0000001
% x7 = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
% z7 = [1.45109486579895,1.66054153442383,1.62474262714386,1.60128939151764,1.67528295516968,1.61420190334320,1.56369519233704,1.58757436275482,1.51225757598877,1.52007842063904,1.56147122383118,1.66061580181122,1.52629220485687,1.58382868766785,1.48982000350952,1.54639327526093,1.56185984611511,1.51333439350128,1.55379009246826,1.46523773670197,1.42648410797119,1.52581632137299,1.45346450805664,1.51277339458466,1.52939033508301,1.45492339134216,1.55919933319092,1.48621976375580,1.39157021045685,1.43506133556366,1.37217307090759,1.31974291801453,1.42113506793976,1.32241201400757,1.40098392963409,1.37431991100311];
% %y7 = [0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001,0.0000001];
% 
% y5 = y4*1/10;
% y6 = y5*1/10;
% y7 = y6*1/10;
% 
% 
% y_1_1 = Fitted_model_1(x1);
% y_2_1 = fittedmodel2(x2);
% y_3_1 = fittedmodel3(x3);
% y_4_1 = fittedmodel4(x4);
% y_5_1 = fittedmodel5(x5);
% y_6_1 = fittedmodel6(x6);
% y_7_1 = fittedmodel7(x7);
% 
% lr = [0.1, 0.01, 0.001, 0.0001, 0.00001, 0.000001, 0.0000001];
% 
% a1 = [y_1_1(1),y_2_1(1),y_3_1(1),y_4_1(1),y_5_1(1),y_6_1(1),y_7_1(1)];
% %a2 = [y_1_1(2),y_2_1(2),y_3_1(2),y_4_1(2),y_5_1(2),y_6_1(2),y_7_1(2)];
% a2 = [y_1_1(3),y_2_1(3),y_3_1(3),y_4_1(3),y_5_1(3),y_6_1(3),y_7_1(3)];
% %a4 = [y_1_1(4),y_2_1(4),y_3_1(4),y_4_1(4),y_5_1(4),y_6_1(4),y_7_1(4)];
% a3 = [y_1_1(5),y_2_1(5),y_3_1(5),y_4_1(5),y_5_1(5),y_6_1(5),y_7_1(5)];
% %a6 = [y_1_1(6),y_2_1(6),y_3_1(6),y_4_1(6),y_5_1(6),y_6_1(6),y_7_1(6)];
% 
% a4 = [y_1_1(7),y_2_1(7),y_3_1(7),y_4_1(7),y_5_1(7),y_6_1(7),y_7_1(7)];
% %a8 = [y_1_1(8),y_2_1(8),y_3_1(8),y_4_1(8),y_5_1(8),y_6_1(8),y_7_1(8)];
% a5 = [y_1_1(9),y_2_1(9),y_3_1(9),y_4_1(9),y_5_1(9),y_6_1(9),y_7_1(9)];
% %a10 = [y_1_1(10),y_2_1(10),y_3_1(10),y_4_1(10),y_5_1(10),y_6_1(10),y_7_1(10)];
% %a11 = [y_1_1(11),y_2_1(11),y_3_1(11),y_4_1(11),y_5_1(11),y_6_1(11),y_7_1(11)];
% % a12 = [y_1_1(12),y_2_1(12),y_3_1(12),y_4_1(12),y_5_1(12),y_6_1(12),y_7_1(12)];
% % 
% % a13 = [y_1_1(13),y_2_1(13),y_3_1(13),y_4_1(13),y_5_1(13),y_6_1(13),y_7_1(13)];
% % a14 = [y_1_1(14),y_2_1(14),y_3_1(14),y_4_1(14),y_5_1(14),y_6_1(14),y_7_1(14)];
% a6 = [y_1_1(15),y_2_1(15),y_3_1(15),y_4_1(7),y_5_1(15),y_6_1(15),y_7_1(15)];
% % a16 = [y_1_1(16),y_2_1(16),y_3_1(16),y_4_1(16),y_5_1(16),y_6_1(16),y_7_1(16)];
% % a17 = [y_1_1(17),y_2_1(17),y_3_1(17),y_4_1(17),y_5_1(17),y_6_1(17),y_7_1(17)];
% % a18 = [y_1_1(18),y_2_1(18),y_3_1(18),y_4_1(18),y_5_1(18),y_6_1(18),y_7_1(18)];
% % 
% % a19 = [y_1_1(19),y_2_1(19),y_3_1(19),y_4_1(19),y_5_1(19),y_6_1(19),y_7_1(19)];
% % a20 = [y_1_1(20),y_2_1(20),y_3_1(20),y_4_1(20),y_5_1(20),y_6_1(20),y_7_1(20)];
% % a21 = [y_1_1(21),y_2_1(21),y_3_1(21),y_4_1(21),y_5_1(21),y_6_1(21),y_7_1(21)];
% % a22 = [y_1_1(22),y_2_1(22),y_3_1(22),y_4_1(22),y_5_1(22),y_6_1(22),y_7_1(22)];
% % a23 = [y_1_1(23),y_2_1(23),y_3_1(23),y_4_1(23),y_5_1(23),y_6_1(23),y_7_1(23)];
% a7 = [y_1_1(24),y_2_1(24),y_3_1(24),y_4_1(24),y_5_1(24),y_6_1(24),y_7_1(24)];
% 
% % a25 = [y_1_1(25),y_2_1(25),y_3_1(25),y_4_1(25),y_5_1(25),y_6_1(25),y_7_1(25)];
% % a26 = [y_1_1(26),y_2_1(26),y_3_1(26),y_4_1(26),y_5_1(26),y_6_1(26),y_7_1(26)];
% % a27 = [y_1_1(27),y_2_1(27),y_3_1(27),y_4_1(27),y_5_1(27),y_6_1(27),y_7_1(27)];
% % a28 = [y_1_1(28),y_2_1(28),y_3_1(28),y_4_1(28),y_5_1(28),y_6_1(28),y_7_1(28)];
% % a29 = [y_1_1(29),y_2_1(29),y_3_1(29),y_4_1(29),y_5_1(29),y_6_1(29),y_7_1(29)];
% % a30 = [y_1_1(30),y_2_1(30),y_3_1(30),y_4_1(30),y_5_1(30),y_6_1(30),y_7_1(30)];
% % 
% % a31 = [y_1_1(31),y_2_1(31),y_3_1(31),y_4_1(31),y_5_1(31),y_6_1(31),y_7_1(31)];
% % a32 = [y_1_1(32),y_2_1(32),y_3_1(32),y_4_1(32),y_5_1(32),y_6_1(32),y_7_1(32)];
% % a33 = [y_1_1(33),y_2_1(33),y_3_1(33),y_4_1(33),y_5_1(33),y_6_1(33),y_7_1(33)];
% % a34 = [y_1_1(34),y_2_1(34),y_3_1(34),y_4_1(34),y_5_1(34),y_6_1(34),y_7_1(34)];
% % a35 = [y_1_1(35),y_2_1(35),y_3_1(35),y_4_1(35),y_5_1(35),y_6_1(35),y_7_1(35)];
% a8 = [y_1_1(36),y_2_1(36),y_3_1(36),y_4_1(36),y_5_1(36),y_6_1(36),y_7_1(36)];
% 
% var = linspace(1,1,7);
% 
% x_1 = [var*1;var*2;var*3;var*4;var*5;var*6;var*7;var*8];
% % x_1 = [var*1;var*2;var*3;var*4;var*5;var*6;var*7;var*8;var*9;var*10;var*11;var*12;var*13;var*14;var*15;var*16;var*17;var*18;var*19;var*20;var*21;var*22;var*23;var*24;var*25;var*26;var*27;var*28;var*29;var*30;var*31;var*32;var*33;var*34;var*35;var*36];
% a = [a1;a2;a3;a4;a5;a6;a7;a8];
% % a = [a1;a2;a3;a4;a5;a6;a7;a8;a9;a10;a11;a12;a13;a14;a15;a16;a17;a18;a19;a20;a21;a22;a23;a24;a25;a26;a27;a28;a29;a30;a31;a32;a33;a34;a35;a36
% % a2 = y_2_1(2)
% % a3 = y_3_1(3),
% 
% figure
% hold on % Use this to plot multiple series on a single figure
% plot3(x1,y1,y_1_1,'Color','black','LineWidth',2)
% plot3(x1,y2,y_2_1,'Color','black','LineWidth',2)
% plot3(x1,y3,y_3_1,'Color','black','LineWidth',2)
% plot3(x1,y4,y_4_1,'Color','black','LineWidth',2)
% plot3(x1,y5,y_5_1,'Color','black','LineWidth',2)
% plot3(x1,y6,y_6_1,'Color','black','LineWidth',2)
% plot3(x1,y7,y_7_1,'Color','black','LineWidth',2)
% hold on;
% 
% for i= 1:8
%     plot3(x_1(i,:),lr,a(i,:),'Color','black','LineWidth',2);
%     hold on;
% end
% 
% a_a = [y_1_1.'; y_2_1.';y_3_1.';y_4_1.';y_5_1.';y_6_1.';y_7_1.'];
% 
% % Creating the Mesh
% hold on;
% surf(x1,lr,a_a)
% alpha(.2)
% zlim([0 3])

% % Labels for NN    
% xlabel('Iterations')
% zlabel('Loss function')
% ylabel('Learning Rate')
% 
% % set Logorithic scale for Learning Rate and add a grid
% set(gca, 'yscale', 'log')
% grid on;
% 
% %
% for k = 1:8
% plot3(int(i),z,'o','MarkerFaceColor','black')
% end
% 
